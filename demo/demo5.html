<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>兔狲 - 策略模式使用</title>
    <script src="//cdn.jsdelivr.net/npm/wenyejie"></script>
  </head>
  <body>
    <div id="app"></div>
    <script sr></script>
    <script type="module">
      import { isFunction, isObject, isArray } from '../node_modules/wenyejie/wenyejie.js'
      const data = {
        'applyCode': '20200717151350000129',
        'canDeductedAmount': 0.02,
        'factory': null,
        'batchId': '159497003075279947648',
        'userName': '张金洲',
        'idCard': '421087198606178236',
        'bankCard': null,
        'amtGrant': 0.12,
        'status': 1,
        'deductedStatus': 0,
        'confirmStatus': 1,
        'createTime': '2020-07-17 15:13:50',
        'grantTime': '2020-07-17 15:14:21',
        'refuseTime': null,
        'grantRemark': '公众号工厂2020年7月工资代发159497004642303',
        'remark': '待领取',
        'payRemark': '发薪备注_0_1594969970373024',
        'grantService': 0.1,
        'passaGeway': 0,
        'grantType': 0,
        'accountType': 4,
        'carryStatus': 0,
        'tips': '',
        'verifyUser': '张金洲',
        'extData': null,
        'accountNumber': '751000000003020',
        'accountBankName': '招商银行',
        'bankZoningCode': '75',
        'purpose': null,
        'expotGrantTo': '公众号账户',
        'createTimeStr': '2020-07-17 15:13:50',
        'grantTimeStr': '2020-07-17 15:14:21',
        'statusStr': '发放成功',
        'dstatusStr': '未扣回',
        'confirmStatusStr': '待确认领取',
        'accountTypeStr': '招商银行招行一般户3020',
        'refuseTimeStr': '',
        'bankNameStr': '--',
        'grantTypeStr': '公众号'
      }

      const render = (h, params) => {
        const row = params.row
        const child = []
        const receipt = h(
          'button',
          {
            class: 'cls_btn inner-edit_btn_blue',
            on: {
              click: () => {
                this.showReceipt(params.row, 0)
              }
            }
          },
          '回单'
        )

        const deducted = h(
          'button',
          {
            class: row.canDeductedAmount ? 'cls_btn inner-edit_btn_blue deduct-btn' : 'cls_btn inner-edit_btn_grey',
            on: {
              click: () => {
                this.onDeducted(params.row)
              }
            }
          },
          '扣回'
        )

        const renderText = (text) => h('span', {}, text)
        if (row.statusStr.includes('失败') || [1, 2].includes(row.grantType)) {
          child.push(renderText(''))
        } else if (row.deductedStatus === 1) {
          child.push(renderText('已扣回'))
        } else if (row.carryStatus === 1) {
          child.push(renderText('已提现'))
        } else if (![8, 10].includes(row.accountType)) {
          child.push(deducted)
        }
        if (!(row.accountType === 9 && row.carryStatus === 0 && row.grantType === 0)) {
          child.push(receipt)
        }
        return child
      }
    </script>
  </body>
</html>
